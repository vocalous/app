{"version":3,"sources":["../../display/dist/constants/index.js","../../display/dist/utils/index.js","../../display/dist/pitch-display/index.js","components/button/index.js","constants/colors.js","model.ts","components/pitch/index.tsx","components/pitch/pitch-monitor.tsx","components/main/app-frame.tsx","translations/index.js","components/language-modal/index.js","components/main/about.tsx","services/tinyurl.js","services/ultrastar-parser.js","components/importer/index.js","components/error-modal/index.js","components/main/sing.js","components/main/index.js","App.tsx","reportWebVitals.ts","index.tsx","services/s1Encoding.js"],"names":["NOTE_STRINGS","centsOffFromPitch","frequency","note","Math","floor","log","pow","frequencyFromNoteNumber","PitchDisplay","container","timeSpan","this","frequencies","melodyNotes","introStateListeners","background","highlight","style","position","canvasStyle","bgCanvas","document","createElement","setAttribute","bgContext","getContext","melodyCanvas","melodyContext","noteCanvas","noteContext","appendChild","lastSongPos","speedChanged","undefined","playingSpeed","melodyStart","inIntro","resize","callback","push","i","length","splice","w","clientWidth","h","clientHeight","dpr","window","devicePixelRatio","scaledW","scaledH","width","height","scale","scaleX","scaleLinear","domain","range","margin","scaleY","render","time","songPos","calculateSongPos","start","prevNote","duration","end","Infinity","nextNote","melodyPitch","f","noteNum","round","noteFromPitch","pitch","nearestMelodyNote","getNearestMelodyNote","diff","Object","assign","filter","val","now","changePlayingSpeed","speed","Date","getTime","full","cleanupFrequencies","drawBackground","drawMelody","drawNotes","drawTimeMarkers","checkIntroState","nowInIntro","color","fillStyle","clearRect","fillRect","y","font","fillText","beginPath","strokeStyle","notes","t","c","clarity","x","arc","PI","fill","marks","mark","ctx","lineWidth","lineCap","startX","endX","moveTo","lineTo","stroke","ControlButton","colorPressed","className","Icon","onCancel","onPress","onRelease","size","useState","pressed","setPressed","handlePress","handleRelease","handleCancel","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchEnd","onTouchCancel","ForwardButton","props","SkipForwardCircleFill","PauseButton","PauseCircleFill","StopButton","StopCircleFill","SkipStartButton","skipIntroMode","setSkipIntroMode","icon","SkipEndCircleFill","SkipStartCircleFill","BACKGROUND","store","createStore","windowSize","detectorName","clarityThreshold","enabled","loading","loaded","stream","audioOptions","audio","echoCancellation","autoGainControl","workerConnection","melody","error","setWindowSize","action","state","payload","setDetectorName","setClarityThreshold","setEnabled","setStream","setLoading","setLoaded","setWorkerConnection","setError","checkAudioContextSupport","thunk","actions","getState","AudioContext","webkitAudioContext","console","initializeStream","a","options","navigator","mediaDevices","getUserMedia","stopStream","getTracks","stop","initializeWorker","worker","Worker","process","messenger","WorkerMessenger","ParentHandshake","connection","setMelodyNotes","typedHooks","createTypedHooks","useStoreActions","useStoreState","useStoreDispatch","PitchComponent","freq","useTranslation","pitchDisplay","useRef","setInIntro","updatePitch","useCallback","current","pushFrequency","requestAnimationFrame","requestRef","useEffect","animate","cancelAnimationFrame","useAnimationFrame","onResize","addEventListener","removeEventListener","hasNotes","btnColor","btnColorPressed","onDisplayRef","element","setBackgroundColor","playSong","subscribeToIntroState","onStop","skipIntroTitle","skipIntroBody","skipIntroPopover","Popover","id","Title","as","Content","Fragment","ref","Navbar","fixed","bg","OverlayTrigger","show","placement","overlay","seekToFirstNote","pauseSong","fastForwardSong","convertByteToFloatBuffer","byteBuf","floatBuf","PitchMonitor","powerThreshold","pitchRenderer","React","setFreq","setClarity","pendingRef","pitchSetupRef","setupConnection","remoteHandle","call","pitchSetup","buffer","Float32Array","audioContext","mediaStreamSource","createMediaStreamSource","analyser","createAnalyser","getFloatTimeDomainData","byteBuffer","Uint8Array","fftSize","connect","warn","getByteTimeDomainData","sampleRate","result","escape","cancelRender","renderFrame","PitchRenderer","AppFrame","children","params","qs","parse","location","search","substr","s1","decodeS1","alert","toString","readMelodyNotes","resources","translation","enUs","esEs","fiFi","i18n","LanguageModal","onClose","debug","language","selected","setSelected","list","name","map","lang","ListGroup","Item","onClick","active","changeLang","changeLanguage","Modal","onHide","backdrop","Body","Footer","Button","variant","About","showLangModal","setShowLangModal","Container","Row","Col","href","target","rel","API","shortenLink","longUrl","url","encodeURIComponent","fetch","response","ok","text","shortUrl","parseUltraStarTxt","data","bpm","beatDuration","gap","lines","split","setBPM","value","parseHeader","line","parts","key","toLowerCase","parseFloat","replace","Error","parseNote","parseInt","floorStart","section","startsWith","FileForm","onComplete","title","setTitle","author","setAuthor","musicLink","setMusicLink","lyricsLink","setLyricsLink","file","setFile","validated","setValidated","useTinyURL","setUseTinyURL","creating","setCreating","fileError","setFileError","generateURL","appPath","queryParams","stringify","music","lyrics","createS1Notes","form","parsed","checkValidity","encoded","encodeS1","txtSongTitle","Form","noValidate","onSubmit","event","preventDefault","stopPropagation","currentTarget","reader","FileReader","evt2","readAsText","Group","Label","Control","required","type","placeholder","maxLength","onChange","evt","controlId","File","custom","Input","accept","isInvalid","files","Feedback","Text","Check","label","checked","disabled","CopyButton","copied","setCopied","handle","clipboard","writeText","txt","Result","Card","body","Importer","setUrl","ErrorModal","keyboard","Header","closeButton","StartButton","setActive","setTimeout","clearTimeout","ExternalLink","link","SongInfo","newTitle","property","content","md","Sing","Tabs","Tab","defaultActiveKey","Nav","Link","eventKey","Pane","Main","App","mainDisplay","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","use","LanguageDetector","initReactI18next","init","detection","caches","fallbackLng","interpolation","escapeValue","ReactDOM","StrictMode","getElementById","PRECISION","SHORT_BITS","LONG_BITS","canUseShort","base64","unsafeBase64","Buffer","from","pos","checksum","origChecksum","readUInt16BE","days","created","lastEnd","bytes","readUIntBE","buffers","lastPos","bitHandle","valueBits","shiftBits","alloc","writeUInt16BE","addTimestamp","num","writeUIntBE","checksumBuf","unshift","safeBase64","concat"],"mappings":"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","file":"static/js/main.aa9a7ec5.chunk.js","sourcesContent":["// Notes start normally from C but we start from F note by using offset.\nexport const NOTE_OFFSET = 7;\nexport const NOTE_STRINGS = [\n    'F',\n    'F♯',\n    'G',\n    'G♯',\n    'A',\n    'A♯',\n    'B',\n    'C',\n    'C♯',\n    'D',\n    'D♯',\n    'E',\n];\nexport const OCTAVE_COLORS = [\n    [121, 85, 72],\n    [158, 158, 158],\n    [96, 125, 139],\n    [76, 175, 80],\n    [244, 67, 54],\n    [33, 150, 243],\n    [0, 150, 136],\n    [255, 235, 59],\n    [0, 188, 212],\n];\n","import { OCTAVE_COLORS } from '../constants';\nexport function noteFromPitch(frequency) {\n    let noteNum = 12 * (Math.log(frequency / 440) / Math.log(2));\n    return Math.round(noteNum) + 69;\n}\nexport function frequencyFromNoteNumber(note) {\n    return 440 * Math.pow(2, (note - 69) / 12);\n}\nexport function centsOffFromPitch(frequency, note) {\n    return Math.floor((1200 * Math.log(frequency / frequencyFromNoteNumber(note))) / Math.log(2));\n}\nexport function colorFromNote(note) {\n    let octave = Math.floor(note / 12) - 1;\n    let idx = Math.min(octave, OCTAVE_COLORS.length - 1);\n    idx = Math.max(0, idx);\n    return OCTAVE_COLORS[idx];\n}\n","import { scaleLinear } from 'd3-scale';\nimport { NOTE_OFFSET, NOTE_STRINGS } from '../constants';\nimport { noteFromPitch, centsOffFromPitch } from '../utils';\nclass PitchDisplay {\n    constructor(container, timeSpan = 15000) {\n        this.frequencies = [];\n        this.melodyNotes = [];\n        this.introStateListeners = [];\n        this.background = '#efefef';\n        this.highlight = '#888888';\n        this.container = container;\n        this.container.style.position = 'relative';\n        const canvasStyle = 'position: absolute; width: 100%; height: 100%;';\n        this.bgCanvas = document.createElement('canvas');\n        this.bgCanvas.setAttribute('style', canvasStyle);\n        this.bgContext = this.bgCanvas.getContext('2d');\n        this.melodyCanvas = document.createElement('canvas');\n        this.melodyCanvas.setAttribute('style', canvasStyle);\n        this.melodyContext = this.melodyCanvas.getContext('2d');\n        this.noteCanvas = document.createElement('canvas');\n        this.noteCanvas.setAttribute('style', canvasStyle);\n        this.noteContext = this.noteCanvas.getContext('2d');\n        this.container.appendChild(this.bgCanvas);\n        this.container.appendChild(this.melodyCanvas);\n        this.container.appendChild(this.noteCanvas);\n        this.timeSpan = timeSpan;\n        this.lastSongPos = 0;\n        this.speedChanged = undefined;\n        this.playingSpeed = 0;\n        this.melodyStart = 0;\n        this.inIntro = false;\n        this.resize();\n    }\n    subscribeToIntroState(callback) {\n        this.introStateListeners.push(callback);\n        return () => {\n            // unsubscribe function\n            for (let i = 0; i < this.introStateListeners.length; i++) {\n                if (this.introStateListeners[i] === callback) {\n                    this.introStateListeners.splice(i, 1);\n                    return;\n                }\n            }\n        };\n    }\n    resize() {\n        let w = this.container.clientWidth;\n        let h = this.container.clientHeight;\n        // If device pixel ratio > 1 like in Retina display, canvas content\n        // looks blurry if not scaled\n        const dpr = window.devicePixelRatio;\n        const scaledW = Math.floor(dpr * w);\n        const scaledH = Math.floor(dpr * h);\n        this.bgCanvas.width = scaledW;\n        this.bgCanvas.height = scaledH;\n        this.bgContext.scale(dpr, dpr);\n        this.melodyCanvas.width = scaledW;\n        this.melodyCanvas.height = scaledH;\n        this.melodyContext.scale(dpr, dpr);\n        this.noteCanvas.width = scaledW;\n        this.noteCanvas.height = scaledH;\n        this.noteContext.scale(dpr, dpr);\n        this.scaleX = scaleLinear()\n            .domain([-(this.timeSpan / 2), this.timeSpan / 2])\n            .range([0, w]);\n        let margin = h / (NOTE_STRINGS.length + 4);\n        this.scaleY = scaleLinear()\n            .domain([0, 2 * NOTE_STRINGS.length - 1])\n            .range([h - margin, margin]);\n        this.render();\n    }\n    // Returns nearest melody note by given time.\n    getNearestMelodyNote(time) {\n        if (!this.melodyNotes.length) {\n            return undefined;\n        }\n        const songPos = this.calculateSongPos(time);\n        for (let i = 0; i < this.melodyNotes.length; i++) {\n            const note = this.melodyNotes[i];\n            let start = 0;\n            if (i > 0) {\n                const prevNote = this.melodyNotes[i - 1];\n                // calculate time between two notes\n                start = (prevNote.start + prevNote.duration + note.start) / 2;\n            }\n            let end = Infinity;\n            if (i < this.melodyNotes.length - 1) {\n                // calculate time between two notes\n                const nextNote = this.melodyNotes[i + 1];\n                end = (note.start + note.duration + nextNote.start) / 2;\n            }\n            if (songPos >= start && songPos < end) {\n                return note;\n            }\n        }\n        // no note found\n        return undefined;\n    }\n    pushFrequency(frequency) {\n        // calculate pitch of the frequency\n        const f = frequency.frequency;\n        const note = noteFromPitch(f);\n        const centsOff = centsOffFromPitch(f, note);\n        const pitch = note + centsOff / 100;\n        let melodyPitch;\n        const nearestMelodyNote = this.getNearestMelodyNote(frequency.time);\n        if (nearestMelodyNote) {\n            // check if other octaves of this pitch are closer to the melody note\n            let diff = (pitch - nearestMelodyNote.pitch) % 12;\n            if (diff > 6) {\n                diff -= 12;\n            }\n            else if (diff < -6) {\n                diff += 12;\n            }\n            melodyPitch = nearestMelodyNote.pitch + diff;\n        }\n        this.frequencies.push(Object.assign(Object.assign({}, frequency), { pitch,\n            melodyPitch }));\n    }\n    cleanupFrequencies() {\n        // Throw away the frequencies that are out of the current display window\n        this.frequencies = this.frequencies.filter((val) => this.now - val.time < this.timeSpan / 2);\n    }\n    setMelodyNotes(melodyNotes) {\n        this.melodyNotes = melodyNotes;\n        this.melodyStart = melodyNotes.length ? melodyNotes[0].start : 0;\n    }\n    playSong() {\n        this.changePlayingSpeed(1);\n    }\n    fastForwardSong() {\n        this.changePlayingSpeed(3);\n    }\n    pauseSong() {\n        this.changePlayingSpeed(0);\n    }\n    calculateSongPos(now) {\n        return this.lastSongPos + this.playingSpeed * (now - this.speedChanged);\n    }\n    changePlayingSpeed(speed) {\n        const now = new Date().getTime();\n        if (this.speedChanged === undefined) {\n            this.speedChanged = now;\n        }\n        this.lastSongPos = this.calculateSongPos(now);\n        this.playingSpeed = speed;\n        this.speedChanged = now;\n    }\n    seekToFirstNote() {\n        this.changePlayingSpeed(0);\n        this.lastSongPos = this.melodyStart;\n    }\n    render(full = true) {\n        this.now = new Date().getTime();\n        // calculate song position\n        const songPos = this.calculateSongPos(this.now);\n        this.cleanupFrequencies();\n        if (full) {\n            this.drawBackground();\n        }\n        this.drawMelody(songPos);\n        this.drawNotes();\n        if (this.melodyNotes.length) {\n            this.drawTimeMarkers(songPos);\n        }\n        this.checkIntroState(songPos);\n    }\n    checkIntroState(songPos) {\n        const nowInIntro = songPos < this.melodyStart;\n        if (nowInIntro !== this.inIntro) {\n            this.inIntro = nowInIntro;\n            for (let i = 0; i < this.introStateListeners.length; i++) {\n                this.introStateListeners[i](nowInIntro);\n            }\n        }\n    }\n    setBackgroundColor(color) {\n        this.background = color;\n        this.drawBackground();\n    }\n    setHighlightColor(color) {\n        this.highlight = color;\n        this.drawBackground();\n    }\n    drawBackground() {\n        let w = this.container.clientWidth;\n        let h = this.container.clientHeight;\n        this.bgContext.fillStyle = this.background;\n        this.bgContext.clearRect(0, 0, w, h);\n        this.bgContext.fillRect(0, 0, w, h);\n        for (let i = 0; i < 2 * NOTE_STRINGS.length; ++i) {\n            let y = this.scaleY(i);\n            this.bgContext.fillStyle = this.highlight + '55';\n            this.bgContext.fillRect(0, y, w, 1);\n            this.bgContext.fillStyle = this.highlight;\n            this.bgContext.font = '14px Fira Sans';\n            this.bgContext.fillText(NOTE_STRINGS[i % NOTE_STRINGS.length], this.scaleX(0) + 20, y - 2);\n        }\n        this.bgContext.fillStyle = this.highlight + '55';\n        this.bgContext.fillRect(this.scaleX(0), 0, 1, h);\n    }\n    drawNotes() {\n        let w = this.container.clientWidth;\n        let h = this.container.clientHeight;\n        this.noteContext.clearRect(0, 0, w, h);\n        this.noteContext.beginPath();\n        this.noteContext.strokeStyle = 'rgba(0, 0, 0, 0.1)';\n        // Calculate notes and colors from frequencies\n        const notes = [];\n        for (let frequency of this.frequencies) {\n            let t = frequency.time;\n            let c = frequency.clarity;\n            let x = this.scaleX(t - this.now);\n            const pitch = frequency.melodyPitch\n                ? frequency.melodyPitch\n                : frequency.pitch;\n            let y = this.scaleY((pitch + NOTE_OFFSET) % 24);\n            // let color = colorFromNote(Math.floor(frequency.pitch));\n            const color = [254, 74, 73];\n            notes.push({\n                time: t,\n                x,\n                y,\n                clarity: c,\n                color,\n            });\n        }\n        // Draw circles\n        for (let note of notes) {\n            const { x, y, clarity, color } = note;\n            this.noteContext.fillStyle = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${clarity * 0.5})`;\n            this.noteContext.beginPath();\n            this.noteContext.arc(x, y, 5, 0, Math.PI * 2);\n            this.noteContext.fill();\n        }\n    }\n    drawTimeMarkers(songPos) {\n        let h = this.container.clientHeight;\n        const marks = [];\n        const interval = 1000;\n        for (let i = -this.timeSpan / 2; i <= this.timeSpan / 2; i += interval) {\n            marks.push({\n                x: this.scaleX(i - (songPos % interval)),\n                y: h - 20,\n            });\n        }\n        this.noteContext.fillStyle = this.highlight;\n        for (let mark of marks) {\n            this.noteContext.beginPath();\n            this.noteContext.arc(mark.x, mark.y, 2, 0, Math.PI * 2);\n            this.noteContext.fill();\n        }\n    }\n    drawMelody(songPos) {\n        let w = this.container.clientWidth;\n        let h = this.container.clientHeight;\n        const ctx = this.melodyContext;\n        ctx.clearRect(0, 0, w, h);\n        ctx.strokeStyle = 'rgba(32, 164, 243, 0.8)';\n        ctx.lineWidth = h / 36;\n        ctx.lineCap = 'round';\n        for (let note of this.melodyNotes) {\n            const { start, duration, pitch } = note;\n            const startX = this.scaleX(start - songPos);\n            const endX = this.scaleX(start - songPos + duration);\n            const y = this.scaleY((pitch + NOTE_OFFSET) % 24);\n            ctx.beginPath();\n            // because lineCap is round, make line a bit shorter\n            ctx.moveTo(startX + ctx.lineWidth / 2, y);\n            ctx.lineTo(endX - ctx.lineWidth / 2, y);\n            ctx.stroke();\n        }\n    }\n}\nexport { PitchDisplay };\n","import React, { useState } from 'react';\nimport {\n  PauseCircleFill,\n  SkipEndCircleFill,\n  SkipForwardCircleFill,\n  SkipStartCircleFill,\n  StopCircleFill,\n} from 'react-bootstrap-icons';\n\nimport './button.css';\n\nfunction ControlButton({\n  color,\n  colorPressed,\n  className,\n  Icon,\n  onCancel,\n  onPress,\n  onRelease,\n  size,\n}) {\n  const [pressed, setPressed] = useState(false);\n  const handlePress = () => {\n    setPressed(true);\n    if (onPress) {\n      onPress();\n    }\n  };\n  const handleRelease = () => {\n    setPressed(false);\n    if (onRelease) {\n      onRelease();\n    }\n  };\n  const handleCancel = () => {\n    setPressed(false);\n    if (onCancel) {\n      onCancel();\n    }\n  };\n  return (\n    <div\n      className={`ctrl-btn ${pressed ? 'ctrl-btn-pressed' : ''} ${className}`}\n      onMouseDown={handlePress}\n      onMouseUp={handleRelease}\n      onMouseLeave={handleCancel}\n      onTouchStart={handlePress}\n      onTouchEnd={handleRelease}\n      onTouchCancel={handleCancel}\n    >\n      <Icon color={pressed ? colorPressed : color} size={size} />\n    </div>\n  );\n}\n\nexport const ForwardButton = (props) => (\n  <ControlButton Icon={SkipForwardCircleFill} {...props} />\n);\n\nexport const PauseButton = (props) => (\n  <ControlButton Icon={PauseCircleFill} {...props} />\n);\n\nexport const StopButton = (props) => (\n  <ControlButton Icon={StopCircleFill} {...props} />\n);\n\nexport const SkipStartButton = (props) => {\n  // Change icon until user releases the button in skip intro mode.\n  // This prevents a bug on iOS where long pressing the button\n  // never receives onTouchCancel event when the icon changes meanwhile.\n  const [skipIntroMode, setSkipIntroMode] = useState(false);\n  const onPress = () => {\n    if (props.inIntro) {\n      setSkipIntroMode(true);\n    }\n    props.onPress();\n  };\n  const onCancel = () => {\n    if (skipIntroMode) {\n      setSkipIntroMode(false);\n    }\n    props.onCancel();\n  };\n  const onRelease = () => {\n    if (skipIntroMode) {\n      setSkipIntroMode(false);\n    }\n    props.onRelease();\n  };\n  const icon =\n    props.inIntro || skipIntroMode ? SkipEndCircleFill : SkipStartCircleFill;\n  return (\n    <ControlButton\n      Icon={icon}\n      {...props}\n      onPress={onPress}\n      onRelease={onRelease}\n      onCancel={onCancel}\n    />\n  );\n};\n","export const BACKGROUND = '#e8eaec';\n\nexport const PRIMARY = '#3f51b5';\nexport const PRIMARY_LIGHT = '#757de8';\nexport const PRIMARY_DARK = '#002984';\nexport const PRIMARY_TEXT = '#ffffff';\n\nexport const SECONDARY = '#9c27b0';\nexport const SECONDARY_LIGHT = '#d05ce3';\nexport const SECONDARY_DARK = '#6a0080';\nexport const SECONDARY_TEXT = '#ffffff';\n","import {\n  action,\n  Action,\n  createStore,\n  createTypedHooks,\n  thunk,\n  Thunk,\n} from 'easy-peasy';\nimport { Connection, ParentHandshake, WorkerMessenger } from 'post-me';\n\ntype Detector = 'mcleod' | 'autocorrelation';\n\ntype ErrorType = 'audio-context' | 'mic-stream' | 'worker';\n\ninterface IMelodyNote {\n  start: number;\n  duration: number;\n  pitch: number;\n}\n\ntype IMelodyNotes = IMelodyNote[];\n\ninterface Melody {\n  title: string;\n  notes: IMelodyNotes;\n}\n\ninterface StoreModel {\n  windowSize: number;\n  setWindowSize: Action<StoreModel, number>;\n\n  detectorName: Detector;\n  setDetectorName: Action<StoreModel, Detector>;\n\n  clarityThreshold: number;\n  setClarityThreshold: Action<StoreModel, number>;\n\n  enabled: boolean;\n  setEnabled: Action<StoreModel, boolean>;\n\n  stream: MediaStream | null | undefined;\n  audioOptions: MediaStreamConstraints;\n  setStream: Action<StoreModel, MediaStream | null>;\n  loading: boolean;\n  setLoading: Action<StoreModel, boolean>;\n  loaded: boolean;\n  setLoaded: Action<StoreModel, boolean>;\n  initializeStream: Thunk<StoreModel, void>;\n  stopStream: Thunk<StoreModel, void>;\n\n  workerConnection: Connection | null | undefined;\n  setWorkerConnection: Action<StoreModel, Connection | null>;\n  initializeWorker: Thunk<StoreModel, void>;\n\n  melody: Melody;\n  setMelodyNotes: Action<StoreModel, IMelodyNotes>;\n  error: ErrorType;\n}\n\nexport const store = createStore<StoreModel>({\n  // Default values\n  windowSize: 2048, // 1024\n  detectorName: 'mcleod',\n  clarityThreshold: 0.7, // 0.5\n  enabled: false,\n  loading: false,\n  loaded: false,\n  stream: null,\n  audioOptions: { audio: { echoCancellation: true, autoGainControl: true } },\n  workerConnection: null,\n  melody: {},\n  error: null,\n\n  setWindowSize: action((state, payload) => {\n    state.windowSize = payload;\n  }),\n  setDetectorName: action((state, payload) => {\n    state.detectorName = payload;\n  }),\n  setClarityThreshold: action((state, payload) => {\n    state.clarityThreshold = payload;\n  }),\n  setEnabled: action((state, payload) => {\n    state.enabled = payload;\n  }),\n  setStream: action((state, payload) => {\n    state.stream = payload;\n  }),\n  setLoading: action((state, payload) => {\n    state.loading = payload;\n  }),\n  setLoaded: action((state, payload) => {\n    state.loaded = payload;\n  }),\n  setWorkerConnection: action((state, payload) => {\n    state.workerConnection = payload;\n  }),\n  setError: action((state, payload) => {\n    state.error = payload;\n  }),\n  checkAudioContextSupport: thunk((actions, payload, { getState }) => {\n    // Safari and old versions of Chrome use window.webkitAudioContext\n    const AudioContext = window.AudioContext || window.webkitAudioContext;\n    if (AudioContext === undefined) {\n      // browser does not support Audio Context\n      actions.setError('audio-context');\n      console.error('Browser does not have window.AudioContext support');\n    }\n  }),\n  initializeStream: thunk(async (actions, payload, { getState }) => {\n    const state = getState();\n    const options = state.audioOptions;\n\n    actions.setLoading(true);\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia(options);\n      actions.setStream(stream);\n      actions.setLoading(false);\n      actions.setLoaded(true);\n    } catch (e) {\n      actions.setError('mic-stream');\n      console.error(e);\n      actions.setStream(null);\n      actions.setLoading(false);\n      actions.setLoaded(false);\n    }\n  }),\n  stopStream: thunk(async (actions, payload, { getState }) => {\n    const stream = getState().stream;\n\n    if (stream) {\n      for (const track of stream.getTracks()) {\n        track.stop();\n      }\n    }\n\n    actions.setStream(null);\n    actions.setLoading(false);\n    actions.setLoaded(false);\n  }),\n  initializeWorker: thunk(async (actions) => {\n    const worker = new Worker(\n      `${process.env.PUBLIC_URL}/pitch-detection/worker.js`\n    );\n\n    const messenger = new WorkerMessenger({ worker });\n\n    try {\n      const connection = await ParentHandshake(messenger, {}, 5, 1000);\n      actions.setWorkerConnection(connection);\n    } catch (e) {\n      actions.setError('worker');\n      console.error('Failed to connect to worker', e);\n      actions.setWorkerConnection(null);\n    }\n  }),\n\n  setMelodyNotes: action((state, payload) => {\n    state.melody.notes = payload;\n  }),\n});\n\n// Create a version of the standard hooks that always references our `StoreModel` type\nconst typedHooks = createTypedHooks<StoreModel>();\n\nexport const useStoreActions = typedHooks.useStoreActions;\nexport const useStoreDispatch = typedHooks.useStoreDispatch;\nexport const useStoreState = typedHooks.useStoreState;\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { Navbar, Popover, OverlayTrigger } from 'react-bootstrap';\nimport { useTranslation } from 'react-i18next';\nimport { PitchDisplay } from 'pitch-display';\n\nimport {\n  ForwardButton,\n  PauseButton,\n  SkipStartButton,\n  StopButton,\n} from '../button';\nimport { BACKGROUND } from '../../constants/colors';\nimport { useStoreActions, useStoreState } from '../../model';\n\n// Custom React hook for requestAnimationFrame\nconst useAnimationFrame = (callback) => {\n  const requestRef = useRef();\n\n  useEffect(() => {\n    const animate = (time) => {\n      callback(time);\n      requestRef.current = requestAnimationFrame(animate);\n    };\n\n    requestRef.current = requestAnimationFrame(animate);\n\n    return () => {\n      cancelAnimationFrame(requestRef.current);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // run this effect only once\n};\n\nexport interface PitchProps {\n  freq: number | null;\n  clarity: number | null;\n}\n\nfunction PitchComponent({ freq, clarity }: PitchProps) {\n  const { t } = useTranslation();\n  const pitchDisplay = useRef();\n  const [inIntro, setInIntro] = useState(false);\n\n  const updatePitch = useCallback(() => {\n    if (!pitchDisplay.current) {\n      return;\n    }\n\n    if (freq && freq > 0) {\n      const time = new Date().getTime();\n      pitchDisplay.current.pushFrequency({\n        frequency: freq,\n        clarity: clarity || 0,\n        time,\n      });\n    }\n    pitchDisplay.current.render(false);\n  }, [clarity, freq]);\n\n  if (freq && freq > 0) {\n    requestAnimationFrame((time) => updatePitch(time));\n  }\n\n  // Keep rendering and scrolling pitchDisplay at regular time intervals\n  // even though the note has not changed\n  useAnimationFrame(updatePitch);\n\n  useEffect(() => {\n    const onResize = () => {\n      if (pitchDisplay.current) {\n        pitchDisplay.current.resize();\n      }\n    };\n    window.addEventListener('resize', onResize);\n    return () => window.removeEventListener('resize', onResize);\n  }, []);\n\n  const notes = useStoreState((state) => state.melody.notes);\n  const hasNotes = notes && notes.notes && notes.notes.length;\n  useEffect(() => {\n    if (pitchDisplay.current && notes && notes.notes) {\n      pitchDisplay.current.setMelodyNotes(notes.notes);\n    }\n  }, [notes]);\n\n  const { stopStream, setEnabled } = useStoreActions((actions) => actions);\n\n  const btnSize = 50;\n  const btnColor = BACKGROUND;\n  const btnColorPressed = '#a6a8aa';\n\n  const onDisplayRef = useCallback(\n    (element) => {\n      if (element && !pitchDisplay.current) {\n        pitchDisplay.current = new PitchDisplay(element, 6000);\n        pitchDisplay.current.setBackgroundColor(BACKGROUND);\n        if (notes) {\n          pitchDisplay.current.setMelodyNotes(notes);\n        }\n        pitchDisplay.current.playSong();\n      }\n    },\n    [notes]\n  );\n\n  useEffect(() => {\n    if (pitchDisplay.current) {\n      return pitchDisplay.current.subscribeToIntroState((val) =>\n        setInIntro(val)\n      );\n    }\n  }, []);\n\n  const onStop = async () => {\n    setEnabled(false);\n    await stopStream();\n    console.log('Stream Stopped');\n  };\n\n  const skipIntroTitle = t('SKIP.TITLE');\n  const skipIntroBody = t('SKIP.BODY');\n  const skipIntroPopover = (\n    <Popover id=\"popover-skip-intro\" className=\"unselectable\">\n      <Popover.Title as=\"h3\">{skipIntroTitle}</Popover.Title>\n      <Popover.Content>{skipIntroBody}</Popover.Content>\n    </Popover>\n  );\n\n  return (\n    <React.Fragment>\n      <div className=\"full unselectable\" ref={onDisplayRef} />\n      <div className=\"navbar-space unselectable\" />\n      <Navbar\n        fixed=\"bottom\"\n        bg=\"dark\"\n        className=\"justify-content-center unselectable\"\n      >\n        {hasNotes && (\n          <OverlayTrigger\n            show={inIntro}\n            placement=\"top\"\n            overlay={skipIntroPopover}\n          >\n            <SkipStartButton\n              onPress={() => pitchDisplay.current.seekToFirstNote()}\n              onRelease={() => pitchDisplay.current.playSong()}\n              onCancel={() => pitchDisplay.current.playSong()}\n              className=\"btn-skip-start\"\n              size={btnSize}\n              color={btnColor}\n              colorPressed={btnColorPressed}\n              inIntro={inIntro}\n            />\n          </OverlayTrigger>\n        )}\n        {hasNotes && (\n          <PauseButton\n            onPress={() => pitchDisplay.current.pauseSong()}\n            onRelease={() => pitchDisplay.current.playSong()}\n            onCancel={() => pitchDisplay.current.playSong()}\n            className=\"btn-pause\"\n            size={btnSize}\n            color={btnColor}\n            colorPressed={btnColorPressed}\n          />\n        )}\n        <StopButton\n          onRelease={onStop}\n          className=\"btn-stop\"\n          size={btnSize}\n          color={btnColor}\n          colorPressed={btnColorPressed}\n        />\n        {hasNotes && (\n          <ForwardButton\n            onPress={() => pitchDisplay.current.fastForwardSong()}\n            onRelease={() => pitchDisplay.current.playSong()}\n            className=\"btn-forward\"\n            size={btnSize}\n            color={btnColor}\n            colorPressed={btnColorPressed}\n          />\n        )}\n      </Navbar>\n    </React.Fragment>\n  );\n}\n\nexport default PitchComponent;\n","import { Connection } from 'post-me';\nimport React from 'react';\nimport { WorkerMethods } from '../../../worker/types';\n\ninterface PitchSetup {\n  analyser?: AnalyserNode;\n  audioContext?: AudioContext;\n  buffer?: Float32Array;\n}\ninterface PitchProps {\n  stream: MediaStream;\n  workerConnection: Connection<{}, WorkerMethods, {}>;\n  detectorName: 'autocorrelation' | 'mcleod';\n  windowSize: number;\n  powerThreshold: number;\n  clarityThreshold: number;\n  enabled: boolean;\n  pitchRenderer: React.ComponentType<{\n    freq: number | null;\n    clarity: number | null;\n  }>;\n}\n\n// Converts byte buffer to float buffer. Buffers must have same length.\nconst convertByteToFloatBuffer = (byteBuf, floatBuf) => {\n  for (let i = 0; i < byteBuf.length; i++) {\n    floatBuf[i] = byteBuf[i] / 128 - 1;\n  }\n};\n\n/**\n * While `enabled` is truthy, get the pitch from the input source,\n * and pass its frequency and clarity to `pitchRenderer`.\n *\n * `pitchRenderer` should be a react component that accepts `freq` and `clarity`\n * props.\n *\n * @export\n * @param {PitchProps} {\n *   stream,\n *   detectorName,\n *   workerConnection,\n *   windowSize,\n *   powerThreshold,\n *   clarityThreshold,\n *   enabled,\n *   pitchRenderer,\n * }\n * @returns\n */\nexport function PitchMonitor({\n  stream,\n  detectorName,\n  workerConnection,\n  windowSize,\n  powerThreshold,\n  clarityThreshold,\n  enabled,\n  pitchRenderer,\n}: PitchProps) {\n  const [freq, setFreq] = React.useState<number | null>(null);\n  const [clarity, setClarity] = React.useState<number | null>(null);\n  const pendingRef = React.useRef(false);\n  const pitchSetupRef = React.useRef<PitchSetup>({});\n\n  // Gets called first-thing whenever this component's props change.\n  const setupConnection = React.useCallback(async () => {\n    await workerConnection\n      .remoteHandle()\n      .call('createDetector', detectorName, windowSize, windowSize / 2);\n    const pitchSetup = pitchSetupRef.current;\n    pitchSetup.buffer = new Float32Array(windowSize);\n    // Old browsers use webkitAudioContext\n    pitchSetup.audioContext = new (window.AudioContext ||\n      window.webkitAudioContext)();\n    // Create an AudioNode from the stream.\n    const mediaStreamSource = pitchSetup.audioContext.createMediaStreamSource(\n      stream\n    );\n    // Connect it to the destination.\n    pitchSetup.analyser = pitchSetup.audioContext.createAnalyser();\n    if (pitchSetup.analyser.getFloatTimeDomainData === undefined) {\n      // byte buffer is needed for support for incomplete audio API implementation\n      pitchSetup.byteBuffer = new Uint8Array(windowSize);\n    }\n    pitchSetup.analyser.fftSize = windowSize;\n    mediaStreamSource.connect(pitchSetup.analyser);\n  }, [pitchSetupRef, windowSize, detectorName, stream, workerConnection]);\n\n  // Find the current pitch/clarity and save it in `freq`/`clarity`.\n  const updatePitch = React.useCallback(async () => {\n    if (!pendingRef.current) {\n      pendingRef.current = true;\n\n      const pitchSetup = pitchSetupRef.current;\n      const { analyser, buffer, byteBuffer, audioContext } = pitchSetup;\n      if (!analyser || !buffer || !audioContext) {\n        console.warn(\n          'Trying to update the pitch, but missing an analyser/buffer/audioContext'\n        );\n        return;\n      }\n      if (analyser.getFloatTimeDomainData !== undefined) {\n        analyser.getFloatTimeDomainData(buffer);\n      } else {\n        // Some browsers do not have AnalyserNode.getFloatTimeDomainData() yet,\n        // so use getByteTimeDomainData method instead.\n        analyser.getByteTimeDomainData(byteBuffer);\n        convertByteToFloatBuffer(byteBuffer, buffer);\n      }\n      const result = await workerConnection\n        .remoteHandle()\n        .call(\n          'getPitch',\n          buffer,\n          audioContext.sampleRate,\n          powerThreshold,\n          clarityThreshold\n        );\n      const frequency = result[0];\n      const clarity = result[1];\n      if (frequency > 0) {\n        setFreq(frequency);\n        setClarity(clarity);\n      } else {\n        setFreq(null);\n        setClarity(null);\n      }\n\n      pendingRef.current = false;\n    }\n  }, [\n    pendingRef,\n    pitchSetupRef,\n    setFreq,\n    setClarity,\n    powerThreshold,\n    clarityThreshold,\n    workerConnection,\n  ]);\n\n  // This function only gets called when the dependencies update, and it automatically\n  // cleans up when it is called subsequent times. It starts an endless loop\n  // of computing the current pitch.\n  React.useEffect(() => {\n    if (!enabled) {\n      // This function runs whenever the state of `enabled` changes.\n      // When this function is re-run, it automatically cancels the\n      // the audio monitoring, so all we need to do is return here.\n      return;\n    }\n    console.log('Starting audio monitoring.');\n    const escape = { cancelRender: false };\n    function renderFrame() {\n      if (escape.cancelRender) {\n        return;\n      }\n      requestAnimationFrame(renderFrame);\n      updatePitch();\n    }\n    (async () => {\n      await setupConnection();\n      renderFrame();\n    })();\n\n    return () => {\n      console.log('Stopping audio monitoring.');\n      escape.cancelRender = true;\n    };\n  }, [setupConnection, updatePitch, enabled]);\n\n  const PitchRenderer = pitchRenderer;\n  return <PitchRenderer freq={freq} clarity={clarity} />;\n}\n","import React, { useEffect } from 'react';\nimport qs from 'qs';\n\nimport { useStoreActions } from '../../model';\nimport { decodeS1 } from '../../services/s1Encoding';\n\nconst readMelodyNotes = () => {\n  const params = qs.parse(window.location.search.substr(1));\n  if (params.s1) {\n    try {\n      return decodeS1(params.s1);\n    } catch (error) {\n      alert(error.toString());\n    }\n  }\n};\n\nexport function AppFrame({ children }: { children: React.ReactNode }) {\n  const { setMelodyNotes } = useStoreActions((actions) => actions);\n  useEffect(() => {\n    const notes = readMelodyNotes();\n    if (notes) {\n      setMelodyNotes(notes);\n    }\n  }, [setMelodyNotes]);\n\n  return (\n    <React.Fragment>\n      <div className=\"main-container\">{children}</div>\n    </React.Fragment>\n  );\n}\n","import i18n from 'i18next';\nimport { initReactI18next } from 'react-i18next';\nimport LanguageDetector from 'i18next-browser-languagedetector';\n\nimport enUs from './en-US.json';\nimport esEs from './es-ES.json';\nimport fiFi from './fi-FI.json';\n\nexport const FALLBACK_LANG = 'en-US';\n\nconst resources = {\n  'en-US': { translation: enUs },\n  'es-ES': { translation: esEs },\n  'fi-FI': { translation: fiFi },\n};\n\nexport const getLanguages = () => [\n  { id: 'en-US', name: 'English' },\n  { id: 'es-ES', name: 'Español' },\n  { id: 'fi-FI', name: 'Suomi' },\n];\n\nexport function initializeTranslations() {\n  i18n\n    .use(LanguageDetector)\n    .use(initReactI18next)\n    .init({\n      detection: {\n        // do not persist anything on browser\n        caches: [],\n      },\n      fallbackLng: FALLBACK_LANG,\n      resources,\n      interpolation: {\n        escapeValue: false,\n      },\n    });\n}\n\nexport default i18n;\n","import React, { useState } from 'react';\nimport { Button, ListGroup, Modal } from 'react-bootstrap';\n\nimport i18n, { getLanguages } from '../../translations';\n\nexport default function LanguageModal({ error, show, onClose }) {\n  console.debug('FOO', i18n.language);\n  const [selected, setSelected] = useState(i18n.language);\n  const list = getLanguages().map((lang) => (\n    <ListGroup.Item\n      action\n      key={lang.id}\n      onClick={() => setSelected(lang.id)}\n      active={selected === lang.id}\n    >\n      {lang.name}\n    </ListGroup.Item>\n  ));\n\n  const changeLang = async () => {\n    await i18n.changeLanguage(selected);\n    onClose();\n  };\n\n  return (\n    <Modal show={show} onHide={onClose} backdrop=\"static\">\n      <Modal.Body>{list}</Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"primary\" onClick={changeLang}>\n          OK\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n","import React, { useState } from 'react';\nimport { Container, Col, Row } from 'react-bootstrap';\nimport { Translate } from 'react-bootstrap-icons';\nimport { useTranslation } from 'react-i18next';\n\nimport LanguageModal from '../language-modal';\nimport './about.css';\n\nexport default function About() {\n  const [showLangModal, setShowLangModal] = useState(false);\n  const { t } = useTranslation();\n  return (\n    <Container>\n      <Row className=\"mb-4\">\n        <Col>\n          <button className=\"btn-lang\" onClick={() => setShowLangModal(true)}>\n            <Translate size={40} color=\"#001233\" />\n          </button>\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <h3>{t('FAQ.TITLE')}</h3>\n          <h5>{t('FAQ.MUSIC.TITLE')}</h5>\n          <p>{t('FAQ.MUSIC.BODY')}</p>\n          <h5>{t('FAQ.HOW_WORKS.TITLE')}</h5>\n          <p>{t('FAQ.HOW_WORKS.BODY1')}</p>\n          <p>{t('FAQ.HOW_WORKS.BODY2')}</p>\n          <h5>{t('FAQ.PROBLEM.TITLE')}</h5>\n          <p>{t('FAQ.PROBLEM.BODY')}</p>\n          <h5>{t('FAQ.PRIVACY.TITLE')}</h5>\n          <p>{t('FAQ.PRIVACY.BODY')}</p>\n          <h5>{t('FAQ.FREE.TITLE')}</h5>\n          <p>{t('FAQ.FREE.BODY')}</p>\n          <h3>{t('SOURCE')}</h3>\n          <p>\n            <a\n              href=\"https://github.com/vocalous/app\"\n              target=\"_blank\"\n              rel=\"noreferrer\"\n            >\n              https://github.com/vocalous/app\n            </a>\n          </p>\n        </Col>\n      </Row>\n      <LanguageModal\n        show={showLangModal}\n        onClose={() => setShowLangModal(false)}\n      />\n    </Container>\n  );\n}\n","// Uses Tiny URL API which is currently public and free.\n\nconst API = 'https://tinyurl.com/api-create.php?url=';\n\nexport async function shortenLink(longUrl) {\n  const url = `${API}${encodeURIComponent(longUrl)}`;\n  const response = await fetch(url);\n  if (response.ok) {\n    const shortUrl = await response.text();\n    return shortUrl;\n  } else {\n    console.error('Error response from Tiny URL', response);\n    return undefined;\n  }\n}\n","// https://thebrickyblog.wordpress.com/2011/01/27/ultrastar-txt-files-in-more-depth/\n\n// Parses content of UltraStar TXT song file and returns parsed data as object.\nexport function parseUltraStarTxt(data) {\n  let bpm; // beats per quarter minute\n  let beatDuration; // duration of a beat in milliseconds\n\n  let gap = 0;\n  const notes = [];\n  const lines = data.split('\\n');\n\n  function setBPM(value) {\n    bpm = value;\n    beatDuration = 60000 / value / 4;\n  }\n\n  setBPM(180); // default\n\n  function parseHeader(line) {\n    const parts = line.substr(1).split(':');\n    const key = parts[0].toLowerCase();\n    const value = parts[1];\n    if (key === 'bpm') {\n      const numValue = parseFloat(value.replace(',', '.'), 10);\n      setBPM(numValue);\n    } else if (key === 'gap') {\n      gap = parseFloat(value.replace(',', '.'), 10);\n    } else if (key === 'relative') {\n      throw new Error('Relative notes not supported!');\n    }\n  }\n\n  function parseNote(line) {\n    const parts = line.substr(2).split(' ');\n    if (parts.length > 3) {\n      const start = gap + parseInt(parts[0], 10) * beatDuration;\n      const duration = parseInt(parts[1], 10) * beatDuration;\n      const pitch = parseInt(parts[2], 10);\n\n      const floorStart = Math.floor(start);\n\n      // truncate previous note if needed\n      if (notes.length > 0) {\n        const prevNote = notes[notes.length - 1];\n        if (prevNote.start + prevNote.duration >= floorStart) {\n          prevNote.duration = floorStart - prevNote.start;\n        }\n      }\n\n      notes.push({\n        start: floorStart,\n        duration: Math.floor(duration),\n        pitch: pitch,\n      });\n    }\n  }\n\n  // start parsing\n  let section = 'header';\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    if (section === 'header') {\n      if (line.startsWith(': ')) {\n        section = 'notes';\n      } else if (line.startsWith('#')) {\n        parseHeader(line);\n      }\n    }\n    if (section === 'notes') {\n      if (\n        line.startsWith(': ') || // regular note\n        line.startsWith('G ') || // golden note\n        line.startsWith('F ')\n      ) {\n        // freestyle note\n        parseNote(line);\n      }\n    }\n  }\n\n  return {\n    bpm: bpm,\n    gap: gap,\n    notes: notes,\n  };\n}\n","import React, { useState } from 'react';\nimport { Button, Card, Col, Container, Form, Row } from 'react-bootstrap';\nimport { useTranslation } from 'react-i18next';\nimport qs from 'qs';\n\nimport { encodeS1 } from '../../services/s1Encoding';\nimport { shortenLink } from '../../services/tinyurl';\nimport { parseUltraStarTxt } from '../../services/ultrastar-parser';\n\nimport './importer.css';\n\nfunction FileForm({ onComplete }) {\n  const { t } = useTranslation();\n  const [title, setTitle] = useState('');\n  const [author, setAuthor] = useState('');\n  const [musicLink, setMusicLink] = useState('');\n  const [lyricsLink, setLyricsLink] = useState('');\n  const [file, setFile] = useState();\n  const [validated, setValidated] = useState();\n  const [useTinyURL, setUseTinyURL] = useState(true);\n  const [creating, setCreating] = useState(false);\n  const [fileError, setFileError] = useState();\n\n  const generateURL = async (params) => {\n    const appPath = window.location.href.split('?')[0];\n    let queryParams = qs.stringify({\n      title: title ? title : undefined,\n      author: author ? author : undefined,\n      music: musicLink ? musicLink : undefined,\n      lyrics: lyricsLink ? lyricsLink : undefined,\n      ...params,\n    });\n    let url = `${appPath}?${queryParams}`;\n    if (onComplete) {\n      if (useTinyURL) {\n        url = await shortenLink(url);\n      }\n      onComplete(url);\n    }\n  };\n\n  const createS1Notes = async (data, form) => {\n    try {\n      const parsed = parseUltraStarTxt(data);\n      if (parsed && parsed.notes.length) {\n        if (form.checkValidity()) {\n          const encoded = encodeS1(parsed);\n          await generateURL({ s1: encoded });\n        }\n        setValidated(true);\n      } else {\n        // invalid file format, no notes found\n        setFileError('invalid');\n      }\n    } catch (error) {\n      console.error(error);\n    }\n    setCreating(false);\n  };\n\n  const start = (form) => {\n    setCreating(true);\n    const reader = new FileReader();\n    reader.addEventListener('load', (evt2) => {\n      createS1Notes(reader.result, form);\n    });\n    reader.readAsText(file);\n  };\n\n  const handleSubmit = (event) => {\n    event.preventDefault();\n    event.stopPropagation();\n    const form = event.currentTarget;\n    if (file) {\n      start(form);\n    } else {\n      setFileError('no-file');\n    }\n  };\n\n  const handleFileChange = (evt) => {\n    if (evt.target.files.length > 0) {\n      // use the first file\n      setFile(evt.target.files[0]);\n    } else {\n      setFile(undefined);\n    }\n    // clear file error\n    setFileError();\n    setValidated(false);\n  };\n\n  const txtSongTitle = t('CREATE.SONG.TITLE');\n\n  return (\n    <Form noValidate validated={validated} onSubmit={handleSubmit}>\n      <Form.Group>\n        <Form.Label>{txtSongTitle}</Form.Label>\n        <Form.Control\n          required\n          type=\"text\"\n          placeholder={txtSongTitle}\n          value={title}\n          maxLength=\"64\"\n          onChange={(evt) => setTitle(evt.target.value)}\n        />\n      </Form.Group>\n      <Form.Group controlId=\"import-file-group\">\n        <Form.File id=\"import-file\" custom>\n          <Form.File.Input\n            accept=\".txt\"\n            isInvalid={!!fileError}\n            onChange={handleFileChange}\n            required\n          />\n          <Form.File.Label>\n            {t('CREATE.SONG.ULTRASTAR_TXT_FILE.LABEL')}\n          </Form.File.Label>\n          <Form.Control.Feedback type=\"invalid\">\n            {t('CREATE.SONG.ULTRASTAR_TXT_FILE.INVALID')}\n          </Form.Control.Feedback>\n        </Form.File>\n        <Form.Text className=\"text-muted\">\n          {t('CREATE.SONG.ULTRASTAR_TXT_FILE.HELP')}\n        </Form.Text>\n      </Form.Group>\n      <Form.Group>\n        <Form.Label>{t('CREATE.SONG.SONG_LINK.LABEL')}</Form.Label>\n        <Form.Control\n          type=\"text\"\n          placeholder=\"https://songs.com/my-song\"\n          value={musicLink}\n          onChange={(evt) => setMusicLink(evt.target.value)}\n        />\n        <Form.Text className=\"text-muted\">\n          {t('CREATE.SONG.SONG_LINK.HELP')}\n        </Form.Text>\n      </Form.Group>\n      <Form.Group>\n        <Form.Label>{t('CREATE.SONG.LYRICS_LINK.LABEL')}</Form.Label>\n        <Form.Control\n          type=\"text\"\n          placeholder=\"https://lyrics.com/my-lyrics\"\n          value={lyricsLink}\n          onChange={(evt) => setLyricsLink(evt.target.value)}\n        />\n        <Form.Text className=\"text-muted\">\n          {t('CREATE.SONG.LYRICS_LINK.HELP')}\n        </Form.Text>\n      </Form.Group>\n      <Form.Group>\n        <Form.Label>{t('CREATE.SONG.LINK_AUTHOR.LABEL')}</Form.Label>\n        <Form.Control\n          type=\"text\"\n          placeholder=\"John Doe <john@doe.com>\"\n          value={author}\n          maxLength=\"64\"\n          onChange={(evt) => setAuthor(evt.target.value)}\n        />\n        <Form.Text className=\"text-muted\">\n          {t('CREATE.SONG.LINK_AUTHOR.HELP')}\n        </Form.Text>\n      </Form.Group>\n      <Form.Group controlId=\"use-tinyurl\">\n        <Form.Check\n          type=\"switch\"\n          id=\"use-tinyurl-switch\"\n          label={t('CREATE.SONG.SHORTEN_LINK_TINYURL')}\n          checked={useTinyURL}\n          onChange={() => setUseTinyURL(!useTinyURL)}\n        />\n      </Form.Group>\n      <Form.Group>\n        <Button\n          className=\"btn-create\"\n          type=\"submit\"\n          variant=\"secondary\"\n          disabled={creating}\n        >\n          {t(`CREATE.SONG.BTN.${creating ? 'CREATING' : 'CREATE_LINK'}`)}\n        </Button>\n      </Form.Group>\n    </Form>\n  );\n}\n\nfunction CopyButton({ url }) {\n  const [copied, setCopied] = useState(false);\n  const handle = async () => {\n    await navigator.clipboard.writeText(url);\n    setCopied(true);\n  };\n  const txt = copied ? 'Copied!' : 'Copy';\n  return (\n    <Button onClick={handle} variant=\"secondary\">\n      {txt}\n    </Button>\n  );\n}\n\nfunction Result({ url }) {\n  const { t } = useTranslation();\n  if (!url) {\n    return null;\n  }\n  return (\n    <>\n      <Row className=\"mt-4 mb-3\">\n        <Col>\n          <div className=\"circled-nbr text-center\">3</div>\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <Card body>\n            <h4>{t('CREATE.SONG.READY.TITLE')}</h4>\n            {t('CREATE.SONG.READY.BODY')}\n            <br />\n            <span className=\"created-link\">{url}</span>\n            <div className=\"float-right\">\n              <CopyButton url={url} />\n            </div>\n          </Card>\n        </Col>\n      </Row>\n    </>\n  );\n}\n\nexport default function Importer() {\n  const [url, setUrl] = useState();\n  const { t } = useTranslation();\n\n  return (\n    <Container>\n      <Row className=\"mb-4\">\n        <Col>\n          <div className=\"circled-nbr text-center\">1</div>\n          {t('CREATE.1.1')}\n          <ul className=\"mt-3\">\n            <li>Yass - Karaoke Editor</li>\n            <li>Performous Composer</li>\n            <li>UltraStar Creator</li>\n          </ul>\n          {t('CREATE.1.2')}\n        </Col>\n      </Row>\n      <Row>\n        <Col>\n          <div className=\"circled-nbr text-center\">2</div>\n        </Col>\n      </Row>\n      <FileForm onComplete={(value) => setUrl(value)} />\n      <Result url={url} />\n    </Container>\n  );\n}\n","import React from 'react';\nimport { Button, Modal } from 'react-bootstrap';\nimport { useTranslation } from 'react-i18next';\n\nexport default function ErrorModal({ error, show, onClose }) {\n  const { t } = useTranslation();\n  let txt = t('ERROR.TXT.DEFAULT');\n  if (error === 'mic-stream') {\n    txt = (\n      <div>\n        {t('ERROR.MIC.TITLE')}\n        <ul>\n          <li>{t('ERROR.MIC.1')}</li>\n          <li>{t('ERROR.MIC.2')}</li>\n          <li>{t('ERROR.MIC.3')}</li>\n        </ul>\n      </div>\n    );\n  } else if (error === 'audio-context') {\n    txt = <div>{t('ERROR.NOT_SUPPORTED')}</div>;\n  }\n  return (\n    <Modal show={show} onHide={onClose} backdrop=\"static\" keyboard={false}>\n      <Modal.Header closeButton>\n        <Modal.Title>{t('ERROR.TITLE')}</Modal.Title>\n      </Modal.Header>\n      <Modal.Body>{txt}</Modal.Body>\n      <Modal.Footer>\n        <Button variant=\"secondary\" onClick={onClose}>\n          {t('OK')}\n        </Button>\n      </Modal.Footer>\n    </Modal>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport { Button, Container, Col, Row } from 'react-bootstrap';\nimport { PlayCircleFill } from 'react-bootstrap-icons';\nimport qs from 'qs';\nimport MetaTags from 'react-meta-tags';\nimport { useTranslation } from 'react-i18next';\n\nimport ErrorModal from '../error-modal';\nimport { useStoreActions, useStoreState } from '../../model';\n\nfunction StartButton() {\n  const [active, setActive] = useState(false);\n  const { initializeStream, setEnabled } = useStoreActions(\n    (actions) => actions\n  );\n\n  // Activate the button soon after it has been mounted.\n  // This prevents a bug where stop button touch triggers this button too\n  // when they are positioned equally.\n  useEffect(() => {\n    const handle = setTimeout(() => setActive(true), 500);\n    return () => clearTimeout(handle);\n  }, []);\n\n  const { t } = useTranslation();\n\n  const start = async () => {\n    await initializeStream();\n    setEnabled(true);\n    console.log('Stream Initialized');\n  };\n\n  return (\n    <Button\n      className=\"btn-start\"\n      variant=\"primary\"\n      onClick={start}\n      disabled={!active}\n    >\n      <div className=\"btn-start-content\">\n        <div className=\"btn-start-text\">{t('START')}</div>\n        <PlayCircleFill size={40} color=\"white\" />\n      </div>\n    </Button>\n  );\n}\n\nfunction ExternalLink({ link, target }) {\n  return (\n    <a href={link} target={target ? target : '_blank'} rel=\"noreferrer\">\n      {link}\n    </a>\n  );\n}\n\nfunction SongInfo() {\n  const { t } = useTranslation();\n  const params = qs.parse(window.location.search.substr(1));\n  const { author, lyrics, music, title } = params;\n  const notes = useStoreState((state) => state.melody.notes);\n  if (!notes) {\n    return null;\n  }\n\n  // Use MetaTags to dynamically change meta tags in <head>,\n  // they are read by crawlers and social media preview fetchers\n  const newTitle = title ? `${title} – Vocalous` : undefined;\n  return (\n    <div className=\"song-info\">\n      {newTitle && (\n        <MetaTags id={title.replace(/[\\W_]+/g, 'x')}>\n          <title>{newTitle}</title>\n          <meta property=\"og:title\" content={newTitle} />\n        </MetaTags>\n      )}\n      <Container>\n        <Row>\n          <Col>\n            <h3>{t('SONG.LINK_CONTAINS')}</h3>\n          </Col>\n        </Row>\n        <Row>\n          <Col md={6}>\n            <div className=\"song-info-details\">\n              <div>\n                <strong>{title ? title : t('SONG.UNTITLED')}</strong>\n              </div>\n              {author && <div>{author}</div>}\n              {music && (\n                <div>\n                  {t('SONG.MUSIC')}{' '}\n                  <ExternalLink link={music} target=\"music--page\" />\n                </div>\n              )}\n              {lyrics && (\n                <div>\n                  {t('SONG.LYRICS')}{' '}\n                  <ExternalLink link={lyrics} target=\"lyrics--page\" />\n                </div>\n              )}\n            </div>\n          </Col>\n          <Col md={6}>\n            <h5>{t('SONG.SING.TITLE')}</h5>\n            <ol>\n              <li>{t('SONG.SING.HEADPHONES')}</li>\n              {music && <li>{t('SONG.SING.PLAY_MUSIC')}</li>}\n              <li>{t('SONG.SING.START')}</li>\n            </ol>\n          </Col>\n        </Row>\n      </Container>\n    </div>\n  );\n}\n\nexport default function Sing() {\n  const error = useStoreState((state) => state.error);\n  const { setError } = useStoreActions((actions) => actions);\n  return (\n    <>\n      <SongInfo />\n      <Container>\n        <Row>\n          <Col className=\"text-center\">\n            <StartButton />\n          </Col>\n        </Row>\n      </Container>\n      <ErrorModal show={!!error} onClose={() => setError(null)} error={error} />\n    </>\n  );\n}\n","import React from 'react';\nimport { Nav, Tab } from 'react-bootstrap';\nimport { useTranslation } from 'react-i18next';\n\nimport About from './about';\nimport Importer from '../importer';\nimport Sing from './sing';\n\nfunction Header() {\n  const { t } = useTranslation();\n  return (\n    <div className=\"heading\">\n      <h1>VOCALOUS</h1>\n      <div>{t('SLOGAN')}</div>\n    </div>\n  );\n}\n\nfunction Tabs() {\n  const { t } = useTranslation();\n  return (\n    <Tab.Container id=\"tab-container\" defaultActiveKey=\"sing\">\n      <Nav variant=\"pills\">\n        <Nav.Item>\n          <Nav.Link eventKey=\"sing\">{t('TAB.SING')}</Nav.Link>\n        </Nav.Item>\n        <Nav.Item>\n          <Nav.Link eventKey=\"create\">{t('TAB.CREATE')}</Nav.Link>\n        </Nav.Item>\n        <Nav.Item>\n          <Nav.Link eventKey=\"help\">\n            <strong>?</strong>\n          </Nav.Link>\n        </Nav.Item>\n      </Nav>\n      <Tab.Content>\n        <Tab.Pane eventKey=\"sing\">\n          <Sing />\n        </Tab.Pane>\n        <Tab.Pane eventKey=\"create\">\n          <Importer />\n        </Tab.Pane>\n        <Tab.Pane eventKey=\"help\">\n          <About />\n        </Tab.Pane>\n      </Tab.Content>\n    </Tab.Container>\n  );\n}\n\nexport default function Main() {\n  return (\n    <>\n      <Header />\n      <Tabs />\n    </>\n  );\n}\n","import React from 'react';\n\nimport PitchComponent from './components/pitch';\nimport { PitchMonitor } from './components/pitch/pitch-monitor';\nimport { AppFrame } from './components/main/app-frame';\nimport { useStoreActions, useStoreState } from './model';\nimport Main from './components/main';\n\nfunction App() {\n  const POWER_THRESHOLD = 0.15;\n\n  const detectorName = useStoreState((state) => state.detectorName);\n  const windowSize = useStoreState((state) => state.windowSize);\n  const clarityThreshold = useStoreState((state) => state.clarityThreshold);\n  const enabled = useStoreState((state) => state.enabled);\n\n  const { loaded, stream, workerConnection } = useStoreState((state) => ({\n    loaded: state.loaded,\n    loading: state.loading,\n    stream: state.stream,\n    workerConnection: state.workerConnection,\n  }));\n\n  const { checkAudioContextSupport, initializeWorker } = useStoreActions(\n    (actions) => actions\n  );\n\n  React.useEffect(() => {\n    (async () => {\n      await initializeWorker();\n      console.log('Worker initialized');\n      await checkAudioContextSupport();\n    })();\n  }, [checkAudioContextSupport, initializeWorker]);\n\n  let mainDisplay = <Main />;\n  if (loaded && stream && workerConnection) {\n    const pitchRenderer = PitchComponent;\n    mainDisplay = (\n      <PitchMonitor\n        stream={stream}\n        detectorName={detectorName}\n        workerConnection={workerConnection}\n        windowSize={windowSize}\n        powerThreshold={POWER_THRESHOLD}\n        clarityThreshold={clarityThreshold}\n        enabled={enabled}\n        pitchRenderer={pitchRenderer}\n      />\n    );\n  }\n\n  return <AppFrame>{mainDisplay}</AppFrame>;\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport { StoreProvider } from 'easy-peasy';\n\nimport { store } from './model';\nimport { initializeTranslations } from './translations';\n\ninitializeTranslations();\n\nReactDOM.render(\n  <React.StrictMode>\n    <StoreProvider store={store}>\n      <App />\n    </StoreProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// Encoder and decoder for melody notes so that they can be added to URL.\n// Binary data is base64 encoded with some characters replaced so that\n// it is safe to be used in URL. Encoding uses lossy compression, original\n// data loses some timing accuracy.\n//\n// Binary starts with 16-bit checksum.\n//\n// Notes follow either in 16-bit or 24-bit format.\n// 16-bit:\n// FXXXXXYYYYZZZZZZ\n// 24-bit:\n// FXXXXXXXXXXXYYYYYYZZZZZZ\n//\n// F: 0=16-bit note, 1=24-bit note\n// X: silence before this note, relative to the end of previous note (0.1 ms)\n// Y: duration (0.1 ms)\n// Z: pitch\n\n// To save space, use larger precision.\nconst PRECISION = 100; // in milliseconds\n\nconst SHORT_BITS = {\n  start: 5,\n  duration: 4,\n  pitch: 6,\n};\n\nconst LONG_BITS = {\n  start: 11,\n  duration: 6,\n  pitch: 6,\n};\n\n// Returns true if this note can be encoded with 16 bits.\nfunction canUseShort(start, duration) {\n  return start < 1 << SHORT_BITS.start && duration < 1 << SHORT_BITS.duration;\n}\n\n// Replaces some characters in base64 encoded data to be URL safe (RFC 3986):\n// '+' -> '_'\n// '/' -> '.'\n// '=' -> '-'\nfunction safeBase64(data) {\n  return data.replace(/\\+/g, '_').replace(/\\//g, '.').replace(/=/g, '-');\n}\n\nfunction unsafeBase64(data) {\n  return data.replace(/_/g, '+').replace(/\\./g, '/').replace(/-/g, '=');\n}\n\nexport function decodeS1(data) {\n  const notes = [];\n  const base64 = unsafeBase64(data);\n  const buffer = Buffer.from(base64, 'base64');\n\n  if (buffer.length < 2) {\n    throw new Error('No content');\n  }\n\n  let pos = 0;\n  let checksum = 0;\n  // read original 16-bit checksum\n  const origChecksum = buffer.readUInt16BE(pos);\n  pos += 2;\n\n  // read 16-bit timestamp\n  const days = buffer.readUInt16BE(pos);\n  pos += 2;\n  checksum += days;\n  const created = new Date(days * 86400000);\n\n  // read content\n  let lastEnd = 0;\n  while (pos < buffer.length) {\n    // check first bit\n    const isLong = buffer.readUIntBE(pos, 1) & 128;\n    let bytes;\n    let start;\n    let duration;\n    let pitch;\n    if (isLong) {\n      // read 24-bit value\n      bytes = 3;\n      const value = buffer.readUIntBE(pos, bytes);\n      start =\n        (value >> (LONG_BITS.duration + LONG_BITS.pitch)) &\n        ((1 << LONG_BITS.start) - 1);\n      duration = (value >> LONG_BITS.pitch) & ((1 << LONG_BITS.duration) - 1);\n      pitch =\n        value & ((1 << LONG_BITS.pitch) - 1) & ((1 << LONG_BITS.pitch) - 1);\n      checksum += value;\n    } else {\n      // read 16-bit value\n      bytes = 2;\n      const value = buffer.readUIntBE(pos, bytes);\n      start =\n        (value >> (SHORT_BITS.duration + SHORT_BITS.pitch)) &\n        ((1 << SHORT_BITS.start) - 1);\n      duration = (value >> SHORT_BITS.pitch) & ((1 << SHORT_BITS.duration) - 1);\n      pitch =\n        value & ((1 << SHORT_BITS.pitch) - 1) & ((1 << SHORT_BITS.pitch) - 1);\n      checksum += value;\n    }\n\n    const note = {\n      start: lastEnd + start * PRECISION,\n      duration: duration * PRECISION,\n      pitch,\n    };\n    notes.push(note);\n    lastEnd = note.start + note.duration;\n    pos += bytes;\n  }\n\n  // 16-bit checksum\n  if ((checksum & 65535) !== origChecksum) {\n    throw new Error('Corrupted data: invalid checksum');\n  }\n\n  return {\n    created,\n    notes,\n  };\n}\n\nexport function encodeS1(data) {\n  const buffers = [];\n  let lastPos = 0;\n  let checksum = 0;\n\n  function bitHandle(value, valueBits, shiftBits) {\n    const max = (1 << valueBits) - 1;\n    if (value > max) {\n      throw new Error(\n        `${valueBits} bits not enough for value ${value}, use another encoding`\n      );\n    }\n    return value << shiftBits;\n  }\n\n  function addTimestamp() {\n    // add timestamp, days since epoch\n    const days = Math.floor(new Date().getTime() / 86400000);\n    const bytes = Buffer.alloc(2);\n    bytes.writeUInt16BE(days);\n    buffers.push(bytes);\n    checksum += days;\n  }\n\n  addTimestamp();\n\n  for (let i = 0; i < data.notes.length; i++) {\n    const note = data.notes[i];\n    const start = Math.floor((note.start - lastPos * PRECISION) / PRECISION);\n    const duration = Math.floor(note.duration / PRECISION);\n    lastPos += start + duration;\n    const pitch = note.pitch;\n\n    if (canUseShort(start, duration)) {\n      // we can write a note with 16 bits\n      let num = bitHandle(\n        start,\n        SHORT_BITS.start,\n        SHORT_BITS.duration + SHORT_BITS.pitch\n      );\n      num += bitHandle(duration, SHORT_BITS.duration, SHORT_BITS.pitch);\n      num += bitHandle(pitch, SHORT_BITS.pitch, 0);\n      const bytes = Buffer.alloc(2);\n      bytes.writeUInt16BE(num);\n      buffers.push(bytes);\n      checksum += num;\n    } else {\n      // write a note with 24 bits\n      let num = 1 << 23; // first bit indicates 24-bit note\n      num += bitHandle(\n        start,\n        LONG_BITS.start,\n        LONG_BITS.duration + LONG_BITS.pitch\n      );\n      num += bitHandle(duration, LONG_BITS.duration, LONG_BITS.pitch);\n      num += bitHandle(pitch, LONG_BITS.pitch, 0);\n      const bytes = Buffer.alloc(3);\n      bytes.writeUIntBE(num, 0, 3);\n      buffers.push(bytes);\n      checksum += num;\n    }\n  }\n\n  // add 16-bit checksum to the beginning of buffer\n  const checksumBuf = Buffer.alloc(2);\n  checksumBuf.writeUInt16BE(checksum & 65535);\n  buffers.unshift(checksumBuf);\n\n  const output = Buffer.concat(buffers).toString('base64');\n  return safeBase64(output);\n}\n"],"sourceRoot":""}